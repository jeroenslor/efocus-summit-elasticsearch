<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css">
	</head>
	<body ng-app="CatalogExampleApp">
		<!-- attach the ExampleController to our main content -->
  		<div ng-controller="ExampleController" class="container">
										
			<h3 class="text-muted" style="margin-bottom: 40px">Catalog search example</h3>			  						  			
			<div class="row">
				<div class="col-md-4">
					<form class="form-inline" ng-submit="search()">						
						<input ng-model="q" type="text" class="form-control">
						<input type="submit" style="position: absolute; left: -9999px"/>													
					</form>
					<h3>Facet 1</h3>
					<ul class="list-unstyled">
  						<li>Term 1</li>
						<li>Term 2</li>
					</ul>
				</div>
				<div class="col-md-8">
					<div class="row">
						<div class="col-sm-6 col-md-4" ng-repeat="hit in searchResult.hits.hits">
							<div class="thumbnail">
							<img src="..." alt="...">
							<div class="caption">
								<h3>Thumbnail label</h3>
								<p>...</p>
								<p><a href="#" class="btn btn-primary" role="button">Add to cart</a></p>
							</div>
							</div>
						</div>
					</div>
				</div>
			</div>									
		</div>
			
		<script src="../bower_components/angular/angular.js"></script>
  		<script src="../bower_components/elasticsearch/elasticsearch.angular.js"></script>
		  
		<script>
			// App module
			//
			// The app module will contain all of the components the app needs (directives,
			// controllers, services, etc.). Since it will be using the components within
			// the elasticsearch module, define it a dependency.
			var CatalogExampleApp = angular.module('CatalogExampleApp', ['elasticsearch']);
			// Service
			//
			// esFactory() creates a configured client instance. Turn that instance
			// into a service so that it can be required by other parts of the application
			CatalogExampleApp.service('client', function (esFactory) {
			return esFactory({
				host: 'localhost:9200'								
			});
			});
			// Controller
			//
			// It requires the "client" service, and fetches information about the server,
			// it adds either an error or info about the server to $scope.
			//
			// It also requires the esFactory to that it can check for a specific type of
			// error which might come back from the client
			CatalogExampleApp.controller('ExampleController', function ($scope, client, esFactory) {						
				$scope.search = function(){								
					client.search({
						index: 'demo',
						type: 'fabrics',
						body:{
							query: {
								filtered: {
									query: ($scope.q ? 
									{
										bool: {
											should: [
												{ match: { name: { query: $scope.q, boost: 2 } }},
												{ match: { description: $scope.q }},
												{ wildcard: { code: '*'+$scope.q.toLowerCase()+'*' }}
											]
										}
									} : 
									{
										match_all : {}
									}),
									filter: {
										
									}
								}
							}
						}
					}).then(function(resp){
						$scope.searchResult = resp;
					});	
				}	
				
				$scope.search();	
			});			
  		</script>		
	</body>
</html>