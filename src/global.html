<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.css">
	</head>
	<body ng-app="GlobalSearchApp">
		
  		<div ng-controller="MainController" class="container">
										
			<h2 class="text-muted" style="margin-bottom: 40px">Global search</h2>	
			
			<div class="row">
				<div class="col-md-4">
																				
				</div>
				<div class="col-md-8">
					<div class="row">												
						<div ng-repeat-start="hit in searchResult.hits.hits"></div>							
																									
						<div ng-repeat-end></div>
					</div>
				</div>																												
			</div>
  		</div>
			
			<script src="bower_components/angular/angular.js"></script>
  			<script src="bower_components/elasticsearch/elasticsearch.angular.js"></script>
		  
		<script>
			
			var GlobalSearchApp = angular.module('GlobalSearchApp', ['elasticsearch']);		
			
			GlobalSearchApp.service('client', function (esFactory) {
				return esFactory({
					host: 'localhost:9200'								
				});
			});				
			
			GlobalSearchApp.controller('MainController', function ($scope, client, esFactory) {																																		
				$scope.search = function(){								
					client.search({
						index: 'demo',
						type: ['pages'],
						body:{
							query: {
								filtered: {
									query: {},
									filter: {}
								}
							}						
						}
					}).then(function(resp){																		
						$scope.searchResult = resp;
					});	
				}
				
				$scope.setType = function(type){					
					$scope.type = type;						
					$scope.search();
				}
				
				$scope.removeType = function(type){
					$scope.type = null;
					$scope.search();
				}													
				
				$scope.search();	
			});							
			
			GlobalSearchApp.filter('unsafe', function($sce) {return $sce.trustAsHtml; });
					
  		</script>		
	</body>
</html>